### 1.PC寄存器

**作用**

PC寄存器用来存储CPU要执行的下一条指令的地址、

**面试题**

- 使用PC寄存器存储字节码指令地址有什么作用？
- 为什么使用PC寄存器记录当前线程的执行地址？
  - 因为CPU需要在不同的线程之间来回切换，切换回来以后就需要知道当前线程接着从哪开始继续执行。

**PC寄存器为每个线程私有**

### 2.虚拟机栈

**栈是运行时单位，堆是存储时单位**

**2.1 概念**

每个线程在创建的时候都会创建一个虚拟机栈，虚拟机栈内部保存着一个个栈帧（一个方法对应一个栈帧），其对应着Java方法的调用

（Java虚拟机栈是线程私有的）

**2.2 作用**

主管Java程序的运行，保存方法的局部变量（8中基本数据类型、对象引用地址）、部分结果，并参与方法的调用和返回。

**2.3 特点**

对于栈来说，不存在垃圾回收问题；但是存在OOM问题。

**2.4常见异常**

java虚拟机规范中允许java栈空间大小是动态的或者是固定不变的。

如果采用固定大小的java虚拟机栈。在创建线程的过程中，如果线程请求分配的栈容量超过java虚拟机所允许的最大容量时，JVM会抛出 StackOverflowError异常。

如果java虚拟机栈可以动态扩展，并且在尝试扩展的时候没有申请到足够的内存，或者在创建线程的时候没有足够的内存去创建对应的虚拟机栈，则JVM会抛出OutofMemoryError异常。

#### 设置虚拟机栈容量大小

```shell
-Xss256M
```

#### 栈帧结构

- 局部变量表

  局部变量表也称为局部变量数组或者本地变量表，主要存储方法的参数、方法内局部变量。

  由于局部变量是线程私有的，不存在线程安全的问题。

  局部变量表的容量大小在编译期就确定下来的，并且在方法运行期间不会改变局部变量表的大小。

  - slot变量槽

    slot变量槽是局部变量表中最基本的存储单元。在局部变量表中，32位以内的数据类型占用一个slot，64位的数据类型占用两个slot变量槽（long型数据、double类型数据）

  - 性能调优与垃圾回收

    在栈帧中，与性能调优最为密切相关的是局部变量表。在方法执行时，虚拟机使用局部变量表完成方法的传递。

    局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量中直接或者间接引用的对象都不会被回收。

- 操作数栈（表达式栈）

  - 主要用于保存计算过程的中间结果，同时作为计算过程变量的临时存储空间

- 动态链接

  > 指向运行时常量池的方法引用

- 方法返回地址

  > 方法正常退出或者异常退出的定义

- 附加信息